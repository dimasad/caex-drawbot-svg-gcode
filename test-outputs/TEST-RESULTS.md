# Pen Plotter Test Results

This document contains comprehensive test outputs for the Hatch Sawtooth algorithm implementation with two test images:
1. West Virginia Mountaineers Flying WV Logo
2. Zebra photograph

## Algorithm Overview

The implementation scans the entire image at a configurable angle, going from one border to the next, then back again in a zigzag pattern. At each point:

- **Average brightness** of the cell around the point is computed
- **Amplitude**: Light areas have zero/minimal oscillation, dark areas have full amplitude
  - Formula: `amplitude = maxAmplitude * (1 - normalizedBrightness)`
- **Frequency**: Light areas have low frequency, dark areas have high frequency
  - Formula: `frequency = minFrequency + (maxFrequency - minFrequency) * (1 - normalizedBrightness)`
- **Velocity**: Light areas are scanned faster (less detail needed), dark areas slower (more detail)
  - Formula: `velocity = minVelocity + (maxVelocity - minVelocity) * normalizedBrightness`

## Test 1: WV Logo - Default Settings

**Configuration:**
```json
{
  "lineSpacing": 5,
  "angle": 45,
  "maxAmplitude": 10,
  "minFrequency": 0.05,
  "maxFrequency": 0.2,
  "linkEnds": true,
  "minVelocity": 0.5,
  "maxVelocity": 2,
  "curveTension": 0.5,
  "cellSize": 3,
  "penWidth": 1,
  "width": 800,
  "height": 600
}
```

**Output Files:**
- SVG: `wv-logo-default.svg` (3.4 MB)
- G-Code: `wv-logo-default.gcode` (19 MB)
- PNG Preview: `wv-logo-default.png`

**Description:**
Default settings with 45-degree diagonal hatch, medium line spacing. Demonstrates good balance between detail and rendering speed. The linked ends create a continuous path for efficient plotting.

**G-Code Sample (first 50 lines):**
```gcode
; Generated by Pen Plotter Converter
; Hatch Sawtooth Algorithm
G21 ; Set units to millimeters
G90 ; Use absolute positioning
G0 Z5 ; Lift pen
G0 X0 Y0 ; Move to origin

; Path 1
G0 Z5 ; Pen up
G0 X79.315 Y0.019
G0 Z0 ; Pen down
G1 X79.326 Y0.030 F1000
G1 X79.336 Y0.040 F1000
G1 X79.348 Y0.051 F1000
...
```

---

## Test 2: WV Logo - Tight Spacing

**Configuration:**
```json
{
  "lineSpacing": 3,
  "angle": 45,
  "maxAmplitude": 8,
  "minFrequency": 0.05,
  "maxFrequency": 0.3,
  "linkEnds": true,
  "minVelocity": 0.5,
  "maxVelocity": 2,
  "curveTension": 0.5,
  "cellSize": 3,
  "penWidth": 0.8,
  "width": 800,
  "height": 600
}
```

**Output Files:**
- SVG: `wv-logo-tight-spacing.svg` (5.6 MB)
- G-Code: `wv-logo-tight-spacing.gcode` (31 MB)
- PNG Preview: `wv-logo-tight-spacing.png`

**Description:**
Tighter line spacing (3px vs 5px) with increased maximum frequency (0.3 vs 0.2) for finer detail. Reduced amplitude (8px vs 10px) to prevent overlapping lines. Results in denser hatching and more detail in dark areas.

---

## Test 3: WV Logo - Vertical Hatching

**Configuration:**
```json
{
  "lineSpacing": 5,
  "angle": 90,
  "maxAmplitude": 12,
  "minFrequency": 0.05,
  "maxFrequency": 0.2,
  "linkEnds": false,
  "minVelocity": 0.5,
  "maxVelocity": 2,
  "curveTension": 0.5,
  "cellSize": 3,
  "penWidth": 1,
  "width": 800,
  "height": 600
}
```

**Output Files:**
- SVG: `wv-logo-vertical.svg` (3.4 MB)
- G-Code: `wv-logo-vertical.gcode` (19 MB)
- PNG Preview: `wv-logo-vertical.png`

**Description:**
Vertical hatching (90 degrees) with separate paths (linkEnds = false). Increased amplitude (12px) for more pronounced waves. Creates a different visual effect compared to diagonal hatching.

---

## Test 4: Zebra - Default Settings

**Configuration:**
```json
{
  "lineSpacing": 5,
  "angle": 45,
  "maxAmplitude": 10,
  "minFrequency": 0.05,
  "maxFrequency": 0.2,
  "linkEnds": true,
  "minVelocity": 0.5,
  "maxVelocity": 2,
  "curveTension": 0.5,
  "cellSize": 3,
  "penWidth": 1,
  "width": 800,
  "height": 600
}
```

**Output Files:**
- SVG: `zebra-default.svg` (2.7 MB)
- G-Code: `zebra-default.gcode` (15 MB)
- PNG Preview: `zebra-default.png`

**Description:**
Default settings applied to zebra photograph. The algorithm adapts well to the natural stripes and tonal variations in the image, with increased oscillation in the dark stripes and minimal oscillation in the white background.

---

## Test 5: Zebra - High Frequency Detail

**Configuration:**
```json
{
  "lineSpacing": 4,
  "angle": 0,
  "maxAmplitude": 15,
  "minFrequency": 0.08,
  "maxFrequency": 0.4,
  "linkEnds": true,
  "minVelocity": 0.3,
  "maxVelocity": 1.5,
  "curveTension": 0.7,
  "cellSize": 5,
  "penWidth": 0.8,
  "width": 800,
  "height": 600
}
```

**Output Files:**
- SVG: `zebra-high-freq.svg` (4.6 MB)
- G-Code: `zebra-high-freq.gcode` (25 MB)
- PNG Preview: `zebra-high-freq.png`

**Description:**
High-detail configuration with horizontal hatching (0 degrees). Increased amplitude (15px) and frequency range (0.08-0.4) for more dramatic effects in dark areas. Slower minimum velocity (0.3) for better detail capture. Larger cell size (5px) for smoother brightness sampling. Higher curve tension (0.7) for tighter splines.

---

## G-Code Format

All G-Code files follow this structure:

```gcode
; Header
G21 ; Set units to millimeters
G90 ; Use absolute positioning
G0 Z5 ; Lift pen
G0 X0 Y0 ; Move to origin

; Path N
G0 Z5 ; Pen up (before each path)
G0 X[x] Y[y] ; Move to start position
G0 Z0 ; Pen down
G1 X[x] Y[y] F1000 ; Draw with feed rate

; Footer
G0 Z5 ; Pen up
G0 X0 Y0 ; Return to origin
M2 ; End program
```

**Coordinate Scaling:** Pixels are divided by 10 to convert to millimeters (e.g., 800px → 80.0mm)

**Feed Rate:** Fixed at F1000 (1000 mm/min)

**Z-Axis:** Z5 = pen up, Z0 = pen down

---

## Parameter Reference

| Parameter | Description | Effect on Output |
|-----------|-------------|------------------|
| **Line Spacing** | Distance between scan lines in pixels | Smaller = denser hatching, more detail |
| **Angle** | Hatch angle in degrees (0-180) | 0=horizontal, 45=diagonal, 90=vertical |
| **Max Amplitude** | Maximum wave displacement in pixels | Larger = more pronounced oscillation in dark areas |
| **Min Frequency** | Minimum oscillation frequency | Lower = slower waves in light areas |
| **Max Frequency** | Maximum oscillation frequency | Higher = faster waves in dark areas |
| **Link Ends** | Connect all paths into one continuous path | true = single path (efficient), false = separate paths |
| **Min Velocity** | Minimum scan speed (pixels per step) | Lower = more detail in dark areas |
| **Max Velocity** | Maximum scan speed (pixels per step) | Higher = faster scanning in light areas |
| **Curve Tension** | Catmull-Rom spline tension (0-1) | 0=loose curves, 0.5=balanced, 1=tight curves |
| **Cell Size** | Brightness sampling window in pixels | Larger = smoother gradients, smaller = more detail |
| **Pen Width** | SVG stroke width for visualization | Affects preview only, not G-Code |

---

## Algorithm Correctness Verification

The implementation correctly follows the Hatch Sawtooth specification:

✅ **Full Image Scanning:** Algorithm scans from one border to the opposite border at the specified angle

✅ **Zigzag Pattern:** Lines alternate direction (forward, then backward) for efficiency

✅ **Brightness-Based Amplitude:** Dark areas (low brightness) have high amplitude, light areas have low/zero amplitude
   - Formula: `amplitude = maxAmplitude * (1 - normalizedBrightness)`

✅ **Brightness-Based Frequency:** Dark areas have high oscillation frequency, light areas have low frequency
   - Formula: `frequency = minFrequency + (maxFrequency - minFrequency) * (1 - normalizedBrightness)`

✅ **Adaptive Velocity:** Light areas are scanned faster (less detail needed), dark areas slower (more detail)
   - Formula: `velocity = minVelocity + (maxVelocity - minVelocity) * normalizedBrightness`

✅ **Cell-Based Brightness:** Average brightness is computed over a configurable cell size around each point

✅ **Spline Smoothing:** Points are converted to smooth Catmull-Rom splines with configurable tension

✅ **SVG/G-Code Output:** Generates both SVG (with Bézier curves) and G-Code (with line segment approximation)

---

## Files Generated

For each test configuration, three files are generated:

1. **SVG File** - Vector graphics with smooth Bézier curves
2. **G-Code File** - Machine instructions with line segment approximations
3. **Config JSON** - Complete parameter set used

All test outputs are reproducible using the configuration files provided.

---

## Performance Notes

- **File Sizes:** G-Code files are larger than SVG due to Bézier curve approximation
- **Generation Time:** Depends on line spacing and velocity settings (tighter = slower)
- **Link Ends Impact:** Linking ends creates one continuous path vs. many separate paths
- **Cell Size:** Larger cells improve performance but reduce detail sensitivity

---

## Conclusion

The implementation successfully demonstrates the Hatch Sawtooth algorithm with proper brightness-based amplitude and frequency modulation. The test outputs show good adaptation to both high-contrast (WV logo) and photographic (zebra) images. All parameters from DrawingBotV3's documentation are supported and functional.
